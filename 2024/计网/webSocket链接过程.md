# 链接过程

WebSocket 是一种在单个 TCP 连接上提供全双工通信的协议。它被设计为能够在一个持久连接中实现低延迟和高效的数据传输，非常适合实时应用，如即时聊天、实时通知、在线游戏等。


## 发起连接

### 客户端发起握手请求：
客户端向服务器发送一个特殊的 HTTP 请求，以发起 WebSocket 连接。这个请求是一个标准的 HTTP GET 请求，包含一些额外的头部字段。

### 请求信息
请求信息用于将 http 切换为 WebSocket协议。

1. Upgrade: websocket：表示请求协议升级为 WebSocket。

2. Connection: Upgrade：指示客户端希望更改连接协议。

3. Sec-WebSocket-Key：客户端生成的一个随机字符串，用于服务器生成 Sec-WebSocket-Accept 头部。

4. Sec-WebSocket-Version：表示 WebSocket 协议版本，通常为 13。

### 服务器响应握手请求：

服务器接收到请求后，如果支持 WebSocket 协议，会返回一个 101 状态码响应，表示协议切换成功。

## 数据传输

握手成功后，客户端和服务器可以通过 WebSocket 连接进行全双工通信。


## 关闭连接

WebSocket 连接可以由客户端或服务器任何一方关闭。关闭连接的过程如下：

- 发送关闭帧：一方发送一个关闭帧，包含关闭状态码和可选的关闭原因。
- 接收关闭帧：接收方应立即回送一个关闭帧，并关闭连接。
- 断开连接：连接被关闭，释放相关资源。


---


## webSocket与http


### 1.协议类型：

#### HTTP:

+ 单向通信协议


#### WebSocket:

+ 全双工通信协议


### 2.连接方式：

#### HTTP:

+ 客户端发起请求，服务器响应请求,每次请求/响应都需要建立和关闭连接（HTTP/1.x），或者在一个持久连接中复用（HTTP/2）。

#### WebSocket:

+ 连接建立后，客户端和服务器可以相互发送数据，不需要重新建立连接。

### 3.数据传输：

#### HTTP:
 + 请求/响应模式，单向通信

#### WebSocket:
+ 全双工通信，客户端和服务器可以随时发送消息

### 4.状态管理：

#### HTTP:

+ 无状态协议，每个请求都是独立的，不保留之前请求的状态。


#### WebSocket:

+ 持久连接，可以在整个连接期间保持状态
